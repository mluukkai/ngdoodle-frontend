"use strict";angular.module("doodleFrontendApp",["ngCookies","ngSanitize"]).config(["$routeProvider",function(a){a.when("/events",{templateUrl:"views/main.html",controller:"EventsCtrl"}).when("/events/:id",{templateUrl:"views/event.html",controller:"EventCtrl"}).when("/register/:id",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/register",{templateUrl:"views/registerSearch.html",controller:"RegisterSearchCtrl"}).when("/new_event",{templateUrl:"views/new_event.html",controller:"NewEventCtrl"}).otherwise({redirectTo:"/events"})}]);var app=angular.module("doodleFrontendApp");app.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.headers.get={Accept:"application/json"},delete a.defaults.headers.common["X-Requested-With"]}]),app.value("BASE_URL","http://ng-doodle-backend.herokuapp.com"),app.factory("Flash",function(){var a={};return a.show=!1,a}),app.filter("twodigits",function(){return function(a){return a>9?""+a:"0"+a}}),app.controller("EventsCtrl",["$scope","$http","BASE_URL",function(a,b,c){a.visible=!1,b.get(c+"/events.json").success(function(b){a.events=b})}]),app.controller("RegisterSearchCtrl",["$scope","$http","$location",function(a,b,c){a.click=function(){c.path("/register/"+a.eid)}}]),app.controller("RegisterCtrl",["$scope","$http","$routeParams","BASE_URL",function(a,b,c,d){var e=function(b){for(var c in a.event.slots){var d=a.event.slots[c];if(d.id==b.id)return c}},f=function(b,c){console.log(a.event.slots[e(b)]),a.event.slots[e(b)].registrations.push({name:c})},g=function(b,c){a.event.slots[e(b)].registrations.splice(c,1)};a.hasMarked=function(a,b){var c=[];return angular.forEach(a.registrations,function(a){c.push(a.name)}),-1!=c.indexOf(b)},a.buttonFor=function(b,c){return a.hasMarked(b,c)?"cancel":"register"},b.get(d+"/register/"+c.id).success(function(b){a.event=b,a.names=[],a.slots=a.event.slots,angular.forEach(b.slots,function(b){angular.forEach(b.registrations,function(b){-1==a.names.indexOf(b.name)&&a.names.push(b.name)})})}),a.register=function(c){console.log(c),console.log(a.name);var e={slot_id:c.id,name:a.name},h=function(a,b){for(var c in a.registrations){var d=a.registrations[c];if(d.name==b)return{index:c,id:d.id}}};if(a.hasMarked(c,a.name)){var i=h(c,a.name);console.log(i),b.delete(d+"/registrations/"+i.id+".json",e).success(function(a){console.log(a),g(c,i.index)}).error(function(){console.log("unauthorized")})}else b.post(d+"/registrations.json",e).success(function(b){console.log(b),f(c,a.name)}).error(function(){console.log("unauthorized")})}}]),app.controller("EventCtrl",["$scope","$http","$routeParams","Flash","BASE_URL",function(a,b,c,d,e){var f=function(){a.newSlot={},a.newSlot.mm=0,a.newSlot.hh=12},g=function(a,b){for(var c in b){var d=b[c];if(d.hh==a.hh&&d.mm==a.mm&&d.date==a.date)return c}};a.flashClicked=function(){a.flash=!1,d.show=!1},a.deleteSlot=function(c){b.delete(e+"/slots/"+c.id+".json").success(function(){var b=g(c,a.event.slots);a.event.slots.splice(b,1)}).error(function(){console.log("unauthorized")})},a.createSlot=function(){var d={event_id:c.id,text:a.newSlot.text,hh:a.newSlot.hh,mm:a.newSlot.mm,date:a.newSlot.date};f(),b.post(e+"/slots.json",d).success(function(b){a.event.slots.push(b)}).error(function(){console.log("unauthorized")})},b.get(e+"/events/"+c.id+".json").success(function(b){a.event=b,a.flash=d.show}),f()}]),app.controller("NewEventCtrl",["$scope","$http","$location","Flash","BASE_URL",function(a,b,c,d,e){a.flashaa=function(){d.show=!0},a.create=function(){var f={name:a.newEvent.name,description:a.newEvent.description};a.newEvent={},b.post(e+"/events.json",f).success(function(a){console.log(a),d.show=!0,c.path("/events/"+a.id)}).error(function(){console.log("unauthorized")})}}]);