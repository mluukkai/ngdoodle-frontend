"use strict";angular.module("doodleFrontendApp",["ngCookies","ngSanitize"]).config(["$routeProvider",function(a){a.when("/events",{templateUrl:"views/main.html",controller:"EventsCtrl"}).when("/events/:id",{templateUrl:"views/event.html",controller:"EventCtrl"}).when("/register/:id",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/register",{templateUrl:"views/registerSearch.html",controller:"RegisterSearchCtrl"}).when("/new_event",{templateUrl:"views/new_event.html",controller:"NewEventCtrl"}).otherwise({redirectTo:"/events"})}]);var app=angular.module("doodleFrontendApp");app.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.headers.get={Accept:"application/json"},delete a.defaults.headers.common["X-Requested-With"]}]),app.value("BASE_URL","http://localhost:3000"),app.factory("Flash",function(){var a={};return a.show=!1,a}),app.factory("Events",["$http","BASE_URL",function(a,b){var c={};return c.query=function(){return a.get(b+"/events.json")},c.get=function(c){return a.get(b+"/events/"+c+".json")},c.by_identifier=function(c){return a.get(b+"/register/"+c+".json")},c.save=function(c){return a.post(b+"/events.json",c)},c}]),app.factory("Slots",["$http","BASE_URL",function(a,b){var c={};return c.save=function(c){return a.post(b+"/slots.json",c)},c.delete=function(c){return a.delete(b+"/slots/"+c+".json")},c}]),app.factory("Registrations",["$http","BASE_URL",function(a,b){var c={};return c.delete=function(c){return a.delete(b+"/registrations/"+c+".json")},c.save=function(c){return a.post(b+"/registrations.json",c)},c}]),app.filter("twodigits",function(){return function(a){return a>9?""+a:"0"+a}}),app.controller("EventsCtrl",["$scope","Events",function(a,b){a.visible=!1,a.wait=!0,b.query().success(function(b){a.events=b,a.wait=!1})}]),app.controller("RegisterSearchCtrl",["$scope","$location",function(a,b){a.click=function(){b.path("/register/"+a.eid)}}]),app.controller("RegisterCtrl",["$scope","$routeParams","Events","Registrations",function(a,b,c,d){var e=function(b){for(var c in a.event.slots){var d=a.event.slots[c];if(d.id==b.id)return c}},f=function(b,c){a.event.slots[e(b)].registrations.push({name:c})},g=function(b,c){a.event.slots[e(b)].registrations.splice(c,1)};a.hasMarked=function(a,b){var c=[];return angular.forEach(a.registrations,function(a){c.push(a.name)}),-1!=c.indexOf(b)},a.buttonFor=function(b,c){return a.hasMarked(b,c)?"cancel":"register"},c.by_identifier(b.id).success(function(b){a.event=b,a.names=[],a.slots=a.event.slots,angular.forEach(b.slots,function(b){angular.forEach(b.registrations,function(b){-1==a.names.indexOf(b.name)&&a.names.push(b.name)})})}),a.register=function(b){var c=function(a,b){for(var c in a.registrations){var d=a.registrations[c];if(d.name==b)return{index:c,id:d.id}}};if(a.hasMarked(b,a.name)){var e=c(b,a.name);d.delete(e.id).success(function(){g(b,e.index)}).error(function(){console.log("unauthorized")})}else{var h={slot_id:b.id,name:a.name};d.save(h).success(function(){f(b,a.name)}).error(function(){console.log("unauthorized")})}}}]),app.controller("EventCtrl",["$scope","$routeParams","$location","$anchorScroll","Flash","Events","Slots",function(a,b,c,d,e,f,g){var h=function(a){var b=[];return a.forEach(function(a){-1==b.indexOf(a.date)&&b.push(a.date)}),b.sort()},i=function(){a.newSlot={},a.newSlot.mm=0,a.newSlot.hh=12},j=function(a,b){for(var c in b){var d=b[c];if(d.hh==a.hh&&d.mm==a.mm&&d.date==a.date)return c}};a.flashClicked=function(){a.flash=!1,e.show=!1},a.deleteSlot=function(b){g.delete(b.id).success(function(){var c=j(b,a.event.slots);a.event.slots.splice(c,1)}).error(function(){console.log("unauthorized")})},a.createSlot=function(){var c={event_id:b.id,text:a.newSlot.text,hh:a.newSlot.hh,mm:a.newSlot.mm,date:a.newSlot.date};i(),g.save(c).success(function(b){a.event.slots.push(b),a.dates=h(a.event.slots)}).error(function(){console.log("unauthorized")})},a.newSlotFor=function(b){a.newSlot.date=b,c.hash("slotcreation"),d()},f.get(b.id).success(function(b){a.event=b,a.dates=h(a.event.slots),a.flash=e.show}),i()}]),app.controller("NewEventCtrl",["$scope","$location","Flash","Events",function(a,b,c,d){a.flashaa=function(){c.show=!0},a.create=function(){var e={name:a.newEvent.name,description:a.newEvent.description};a.newEvent={},d.save(e).success(function(a){console.log(a),c.show=!0,b.path("/events/"+a.id)}).error(function(){console.log("unauthorized")})}}]);